<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta content="小金井こども将棋大会のご案内や将棋研究会,小金井子供将棋教室、将棋大会の紹介をしています。" name="description" />
  <meta content="小金井将棋、小金井子供将棋大会、小金井こども将棋大会,小金井将棋大会,武蔵小金井将棋,小金井将棋研究会,小金井子供将棋教室,小金井こども将棋教室,小金井将棋大会,伊藤能,伊藤能自宅教室,伊藤能自宅こども教室" name="keywords" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>マイページ|小金井将棋</title>
  <link rel="SHORTCUT ICON" href="favicon.ico"> 
  <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" integrity="sha384-zF4BRsG/fLiTGfR9QL82DrilZxrwgY/+du4p/c7J72zZj+FLYq4zY00RylP9ZjiT" crossorigin="anonymous">
  <link href="custom.css" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
  <link href="http://koganeishougi.homepagelife.jp/_sc_index_rss20.xml" rel="alternate" title="RSS2.0" type="application/rss+xml" />
  <link rel="stylesheet" href="https://cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.css"/> 
  <script src="https://cdn.datatables.net/t/bs-3.3.6/jqc-1.12.0,dt-1.10.11/datatables.min.js"></script>
  <script type="text/javascript">
    window.onload = function onLoad() {
      win = 0;
      winningStreak = 0;
      loose = 0;
      loosingStreak = 0;
      consecutive = 1;
      param = GetQueryString();
      target = document.getElementById("param");
      target.innerHTML = param["name"];
    }
    function GetQueryString() {
      if (1 < document.location.search.length) {
        // 最初の1文字 (?記号) を除いた文字列を取得する
        var query = document.location.search.substring(1);
        // クエリの区切り記号 (&) で文字列を配列に分割する
        var parameters = query.split('&');
        var result = new Object();
        for (var i = 0; i < parameters.length; i++) {
          // パラメータ名とパラメータ値に分割する
          var element = parameters[i].split('=');
          var paramName = decodeURIComponent(element[0]);
          var paramValue = decodeURIComponent(element[1]);
          // パラメータ名をキーとして連想配列に追加する
          result[paramName] = decodeURIComponent(paramValue);
        }
        return result;
      }
      return null;
    }
  </script>
  <script>
    $.fn.dataTable.ext.search.push(
      function( settings, data, dataIndex ) {
        if (data[2] == param["name"]){
          win = win + 1;
          winningPercentage = Math.round(win * 1000 / (win + loose)) / 1000;
          targetW = document.getElementById("win");
          targetW.innerHTML = win;
          targetWP = document.getElementById("winningPercentage");
          targetWP.innerHTML = winningPercentage.toFixed(3);
          if (consecutive == 1 && loosingStreak == 0){
            winningStreak = winningStreak + 1;
            targetWS = document.getElementById("streak");
            targetWS.innerHTML = winningStreak+"連勝中";
          }else{
            consecutive = 0;
          }
          return true;
        }
        if (data[5] == param["name"]){
          loose = loose + 1;
          winningPercentage = Math.round(win * 1000 / (win + loose)) / 1000;
          targetL = document.getElementById("loose");
          targetL.innerHTML = loose;
          targetWP = document.getElementById("winningPercentage");
          targetWP.innerHTML = winningPercentage.toFixed(3);
          if (consecutive == 1 && winningStreak == 0){
            loosingStreak = loosingStreak + 1;
            targetLS = document.getElementById("streak");
            targetLS.innerHTML = loosingStreak+"連敗中";
          }else{
            consecutive = 0;
          }
          return true;
        }
        return false;
      }
    );
        jQuery(function($){
            $.extend( $.fn.dataTable.defaults, { 
              language: {
                url: "http://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Japanese.json"
              } 
            }); 
            $("#foo-table").dataTable({
                ajax: { url: "standings-with-rating.json", dataSrc: 'standings' },
                order: [0, "desc"],
                columns: [
                  { data: "no" },
                  { data: "date" },
                  { data: "name1" },
                  { data: "degree1" },
                  { data: "rating1" },
                  { data: "name2" },
                  { data: "degree2" },
                  { data: "rating2" },
                  { data: "type" }
                ]
            });
        });
  </script>
</head>
 
<body>
  <div class="navbar navbar-default navbar-fixed-top">
    <div class="container">
       <div class="navbar-header">
         <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-main">
           <span class="sr-only">メニュー</span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="icon-bar"></span>
           <span class="hamburger-text">MENU</span>
        </button>
      </div>
      <div class="collapse navbar-collapse" id="navbar-main">
        <ul class="nav navbar-nav">
          <li><a href="index.html">トップ</a></li>
          <li><a href="01.html">こども将棋大会予告</a></li>
          <li><a href="02.html">こども将棋教室のご案内</a></li>
          <li><a href="03.html">小金井将棋研究会</a></li>
          <li><a href="04.html">リンク集</a></li>
          <li><a href="06.html">将棋大会結果</a></li>
          <li><a href="http://koganeishougi.homepagelife.jp/_sc_index_rss20.xml"><img src="img/btn_rss3_05.gif" /></a></li>
        </ul>
      </div>
    </div>
  </div>
  
  
  
  <div class="container">
    <div class="page-header" id="banner">
      <br />
      <div class="row">
        <div class="col-lg-2 col-md-3 col-sm-4">
          <img src="img/logo.jpeg" alt="小金井の将棋道場です" height="90" width="90" position="bottom" />
        </div>
        <div class="col-lg-10 col-md-9 col-sm-8">
          <h1><div id="param"></div>さんのマイページ</h1>
          <p class="lead">KOGANEI SHOGI</div></p>
        </div>
      </div>
    </div>
    <div class="row">
        <div class="panel panel-primary">
          <div class="panel-heading">通算成績</div>
            <div class="panel-body">
              <div class="col-lg-12 col-md-12 col-sm-12">
                <p>現在<span id="streak"></span>です。</p>
                <table class="table">
                  <thead>
                    <tr><th>項目</th><th>成績</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>勝</td><td><span id="win"></span></script></td></tr>
                    <tr><td>負</td><td><span id="loose"></span></script></td></tr>
                    <tr><td>勝率</td><td><span id="winningPercentage"></span></script></td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
        <div class="panel panel-primary">
          <div class="panel-heading">勝敗表</div>
            <div class="panel-body">
              <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="table-responsive">
                  <table id="foo-table" class="table table-bordered table-striped table-hover">
                  <thead>
                  <tr><th>No</th><th>日付</th><th>勝</th><th>段</th><th>レーティング</th><th>負</th><th>段</th><th>レーティング</th><th>種別</th></tr>
                  </thead>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12 col-md-12 col-sm-12">

    <div class="row">
        <div class="panel panel-primary">
          <div class="panel-heading">レーティング推移</div>
          <div class="panel-body">
          
<canvas id="myChart"></canvas>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>
  <script>
var ctx = document.getElementById('myChart').getContext('2d');
var jsonData = $.ajax({
   url: 'http://koganeishougi.homepagelife.jp/sandbox/standings-with-rating.json', 
   dataType: 'json',
 }).done(function (results) {
   var labels = [], data=[];
   results["standings"]
     .sort(function(a,b){
       return a.no < b.no ? -1 : 1;
     })
     .forEach(function(standings) {
       if (standings.date > "2016-01-01"){
         if (standings.name1==param["name"]){
           labels.push(standings.no);
           data.push(parseFloat(standings.rating1));
         }
         if (standings.name2==param["name"]){
           labels.push(standings.no);
           data.push(parseFloat(standings.rating2));
         }
       }
     });
   var myChart = new Chart(ctx, {
     type : 'line',
     data : {
        labels : labels,
        datasets : [{
            label : param["name"],
            data : data
        }]
     },
     options: {
       scales: {
         yAxes: [
           {
             ticks: {
               beginAtZero: true,
               min: 800,
               max: 1200
             }
           }
         ]
       }
     }
   });
});
  </script>
    </div>
    </div>
    </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>
</html>